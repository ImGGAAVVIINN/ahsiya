<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHSIYA</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Arial', sans-serif;
        }

        #videoContainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: #000;
        }

        #videoPlayer {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
            transition: transform 0.3s ease;
            border-radius: 8px;
        }

        #playButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #playButton svg {
            width: 40px;
            height: 40px;
            fill: #000;
        }

        #videoPlayer.paused + #playButton {
            opacity: 1;
        }

        #progressBarContainer {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        #progressBar {
            width: 0%;
            height: 100%;
            background-color: #ffffff;
            transition: width 0.2s ease;
        }

        #redirectCircle {
            position: absolute;
            width: 150px;
            height: 150px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            cursor: pointer;
            background: radial-gradient(circle, rgba(255,255,255,0.7), rgba(255,255,255,0.2));
            background-image: url("https://static.vecteezy.com/system/resources/thumbnails/018/923/646/small/web-button-icons-png.png");
            background-size: 100%;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @media (max-width: 768px) {
            #playButton {
                width: 60px;
                height: 60px;
            }

            #playButton svg {
                width: 30px;
                height: 30px;
            }

            #progressBarContainer {
                width: 90%;
            }
        }
    </style>
</head>
<body>

<div id="videoContainer">
    <video id="videoPlayer" autoplay muted></video>
    <div id="playButton">
        <svg viewBox="0 0 24 24">
            <polygon points="6,4 20,12 6,20"></polygon>
        </svg>
    </div>
    <div id="progressBarContainer">
        <div id="progressBar"></div>
    </div>
    <div id="redirectCircle"></div>
</div>
    
    <script>
        const videoLinks = [
        //ahsiya intro
        'https://link.storjsatelliteshare.io/s/jwx62xz6ogmk7slngywbl7teegfq/aa1%2Fahsiya-intro.mp4?view=1',
        //aa1
        'https://link.storjsatelliteshare.io/s/jvljyy2eyfzgvjmkkjzddgi5cxba/aa1%2F3459215cf4440cab50322ac6a685325a.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jvq6jpz4xdlp4hqkukcwokrj5jka/aa1%2F46520cc4d47c81df1b27535fef2c0188.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jws4vgbqlrnnryclow3wbuiq7h6a/aa1%2F5baf2b70b18ef7c3d0e4d11bacd7c344.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxk6fqdfrdbcuzs25b5ars72wkqq/aa1%2Fd40d1674dc398792c742c6097c29de11.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxlyxosit3s6gdff5n4nayjknbqa/aa1%2Flv_0_20240518220937.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/juyttxmwqcytvtzaecaggr4pcy4a/aa1%2Flv_0_20240524202351.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jueji5zpq6mfl6ryrq6q2o3u6mya/aa1%2Flv_0_20240720225010.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jvyif4mzcqq725jh4fxt74zy6auq/aa1%2Flv_0_20240802225004.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jul3yknzr3nsyrspiuvwwaybtpja/aa1%2FRDT_20240525_192752.mp4?view=1',
        //aa2
        'https://link.storjsatelliteshare.io/s/juz655sfzktalb3sah5chsgaydxq/aa2%2F456598408_7804285563026789_5944112310659083646_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxczmgy4lqwjwmrhsv67uig54jea/aa2%2F456711265_27216442997954795_7065164847423848830_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxzri75mdr3atqfkulfgbupl24zq/aa2%2F456713241_8928871023795866_5871626189483499291_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxijijxmiv4xl7saajoozy7etpoa/aa2%2F456909216_8057433167686309_1616290838543572092_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxlcn7u4bqagvvnkexxzwznc23kq/aa2%2F457141878_26511636631816530_2267311591772088734_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jvztunzmq6hcymxpsfpwlnosu5dq/aa2%2F457175770_8057601631002324_1368104476340286838_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jwry3s4kvnbvs5gfysbo5w34mscq/aa2%2F457228987_8482807861750390_2478128430927144203_n.mp4?view=1',
        'https://link.storjsatelliteshare.io/s/jxxu5baolzniqwdiqp76a2pts7sa/aa2%2F457280370_7308339682602775_825640068035192075_n.mp4?view=1',
        //aa3
        '',
        ];

        let currentIndex = 0;
        let videoHistory = [];
        const maxHistorySize = 5; // Maximum number of recent videos to track
        const swipeThreshold = 0.2; // Threshold for swipe detection (50% of screen width)
        const firstVideoIndex = 0; // Index of the first video

        let noRepeatLimit = 10; // Number of swipes before a video can repeat

        const videoPlayer = document.getElementById('videoPlayer');
        const redirectCircle = document.getElementById('redirectCircle');
        let videoList = [...videoLinks]; // Clone videoLinks to manage video removal
        let interacted = false; // To track if user has interacted

        function playVideo(index) {
            currentIndex = index;
            videoPlayer.src = videoList[index];
            videoPlayer.controls = (index !== firstVideoIndex); // Hide controls for the first video

            // Mute the first video and unmute others
            videoPlayer.muted = (index === firstVideoIndex) ? !interacted : false;

            // Loop all videos except the first one
            videoPlayer.loop = (index !== firstVideoIndex);

            videoPlayer.play();

            // Show the redirect circle only for the first video
            if (index === firstVideoIndex) {
                redirectCircle.style.display = 'block';
            } else {
                redirectCircle.style.display = 'none';
            }

                // Show or hide the redirectCircle based on the video index
        if (index === firstVideoIndex) {
            redirectCircle.style.display = 'block';
            progressBarContainer.style.display = 'none'; // Hide progress bar
        } else {
            redirectCircle.style.display = 'none';
            progressBarContainer.style.display = 'block'; // Show progress bar
        }
            }

        function adjustVideoSize() {
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.style.width = '100%';
            videoPlayer.style.height = '100%';
        }

        // Ensure adjustVideoSize is called when the video metadata is loaded
        videoPlayer.addEventListener('loadedmetadata', adjustVideoSize);

        // Optionally, call adjustVideoSize when the window is resized
        window.addEventListener('resize', adjustVideoSize);

        function getRandomIndex(excludeIndexes) {
            let randomIndex;
            const validIndexes = videoList
                .map((_, index) => index)
                .filter(index => !excludeIndexes.includes(index) && index !== firstVideoIndex); // Exclude the first video and recently played ones

            if (validIndexes.length === 0) {
                return excludeIndexes[Math.floor(Math.random() * excludeIndexes.length)];
            }

            randomIndex = validIndexes[Math.floor(Math.random() * validIndexes.length)];
            return randomIndex;
        }

        function swipeLeft() {
            if (videoHistory.length > 0) {
                let previousIndex = videoHistory.pop();
                if (previousIndex === firstVideoIndex) {
                    if (videoHistory.length > 0) {
                        previousIndex = videoHistory.pop();
                    } else {
                        return; // If no other history, stop swiping
                    }
                }
                playVideoWithAnimation(previousIndex, 'right');
            }
        }

        function swipeRight() {
            if (currentIndex === firstVideoIndex) return; // Prevent swiping on the first video

            videoHistory.push(currentIndex);
            if (videoHistory.length > maxHistorySize) {
                videoHistory.shift(); // Keep the history size within the limit
            }
            const recentVideos = videoHistory.slice(-noRepeatLimit); // Last N videos to avoid repeating
            const newIndex = getRandomIndex(recentVideos);
            playVideoWithAnimation(newIndex, 'left');
        }

        function playVideoWithAnimation(newIndex, direction) {
            const oldVideoPlayer = videoPlayer.cloneNode(); // Clone the current video player
            oldVideoPlayer.src = videoPlayer.src; // Set the source to the current video

            // Append the old video player to the container for the transition
            videoContainer.appendChild(oldVideoPlayer);

            // Set up the initial positions for the swipe animation
            if (direction === 'left') {
                videoPlayer.style.transform = 'translateX(100%)';
            } else if (direction === 'right') {
                videoPlayer.style.transform = 'translateX(-100%)';
            }

            // Load the new video
            videoPlayer.src = videoList[newIndex];
            videoPlayer.controls = (newIndex !== firstVideoIndex);
            videoPlayer.muted = (newIndex === firstVideoIndex) ? !interacted : false;
            videoPlayer.loop = (newIndex !== firstVideoIndex);
            videoPlayer.play();

            // Trigger the animation by moving the videos
            setTimeout(() => {
                if (direction === 'left') {
                    oldVideoPlayer.style.transform = 'translateX(-100%)';
                    videoPlayer.style.transform = 'translateX(0)';
                } else if (direction === 'right') {
                    oldVideoPlayer.style.transform = 'translateX(100%)';
                    videoPlayer.style.transform = 'translateX(0)';
                }
            }, 10); // Delay to allow for DOM update before starting transition

            // Remove the old video player after the transition ends
            oldVideoPlayer.addEventListener('transitionend', () => {
                videoContainer.removeChild(oldVideoPlayer);
            });
        }

        function handleTouchStart(evt) {
            const firstTouch = evt.touches[0];
            xDown = firstTouch.clientX;
            windowWidth = window.innerWidth;
        }

        function handleTouchMove(evt) {
            if (!xDown) {
                return;
            }

            let xUp = evt.touches[0].clientX;
            let xDiff = xDown - xUp;

            if (Math.abs(xDiff) > windowWidth * swipeThreshold) {
                interacted = true; // Set interacted to true on swipe
                if (xDiff > 0) {
                    swipeRight(); // Swipe right advances to a new random video
                } else {
                    swipeLeft(); // Swipe left goes back to the previous video
                }
                xDown = null; // Reset value
            }
        }

        let xDown = null;
        let windowWidth = window.innerWidth;

        document.addEventListener('touchstart', handleTouchStart, false);
        document.addEventListener('touchmove', handleTouchMove, false);

        // Redirect to the second video when the circle is clicked
        redirectCircle.addEventListener('click', () => {
            let randomIndex = getRandomIndex([currentIndex, firstVideoIndex]); // Exclude current and first video index
            playVideo(randomIndex);
        });

        //this part is added by gpt, might be incompatable
        videoPlayer.addEventListener('pause', () => {
            videoPlayer.classList.add('paused');
        });

        videoPlayer.addEventListener('play', () => {
            videoPlayer.classList.remove('paused');
        });

        playButton.addEventListener('click', () => {
            if (videoPlayer.paused) {
                videoPlayer.play();
            } else {
                videoPlayer.pause();
            }
        });

        videoPlayer.addEventListener('timeupdate', () => {
            const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = `${progress}%`;
        });

        // Initial video play
        playVideo(currentIndex);


    </script>
</body>
</html>
